<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>V9 PRO â€“ AnÃ¡lise JurÃ­dica Profissional</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.5.0/docx.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
<style>
:root{
  --gold:#c9a84c;--gold-light:#e8c96b;--gold-dark:#8b6914;
  --bg:#060606;--card:#0e0e0e;--card2:#141414;--border:#222;
  --text:#e0d5c0;--muted:#6b6050;--green:#2ecc71;--red:#e74c3c;--yellow:#f39c12;--blue:#3498db;
}
*{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:'Rajdhani',sans-serif;font-size:15px;line-height:1.6;min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--gold-dark) 20%,var(--gold-light) 50%,var(--gold-dark) 80%,transparent);z-index:1000}

/* â”€â”€ TOPBAR â”€â”€ */
.topbar{background:#0a0a0a;border-bottom:1px solid var(--border);padding:10px 20px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:500}
.topbar-logo{font-family:'Cinzel',serif;font-size:.9rem;letter-spacing:.3em;background:linear-gradient(135deg,var(--gold-dark),var(--gold-light));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.topbar-actions{display:flex;gap:8px;align-items:center}
.btn-hist{background:transparent;border:1px solid var(--border);border-radius:3px;color:var(--muted);font-family:'Rajdhani',sans-serif;font-size:.6rem;letter-spacing:.15em;padding:6px 12px;cursor:pointer;text-transform:uppercase;transition:all .2s}
.btn-hist:hover{border-color:var(--gold-dark);color:var(--gold)}
.hist-count{background:var(--gold-dark);color:#000;font-size:.5rem;font-weight:700;border-radius:10px;padding:1px 5px;margin-left:4px}

/* â”€â”€ HEADER â”€â”€ */
header{text-align:center;padding:36px 20px 18px}
.logo-text{font-family:'Cinzel',serif;font-size:clamp(1.4rem,4vw,2.3rem);letter-spacing:.4em;background:linear-gradient(135deg,var(--gold-dark),var(--gold-light),var(--gold),var(--gold-dark));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;display:inline-block}
.logo-sub{font-size:.58rem;letter-spacing:.35em;color:var(--muted);margin-top:5px;text-transform:uppercase}
.logo-badges{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-top:9px}
.badge{font-size:.48rem;letter-spacing:.18em;color:var(--gold-dark);border:1px solid var(--gold-dark);padding:2px 9px;border-radius:2px;text-transform:uppercase}
header::after{content:'';display:block;width:260px;height:1px;background:linear-gradient(90deg,transparent,var(--gold-dark),var(--gold),var(--gold-dark),transparent);margin:12px auto 0}

.container{max-width:960px;margin:0 auto;padding:22px 16px 80px;position:relative;z-index:1}

/* â”€â”€ CARDS â”€â”€ */
.card{background:var(--card);border:1px solid var(--border);border-radius:6px;padding:22px;margin-bottom:16px;position:relative;overflow:hidden}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--gold-dark),var(--gold),var(--gold-dark),transparent)}
.slabel{font-size:.55rem;letter-spacing:.3em;color:var(--gold);text-transform:uppercase;margin-bottom:14px;display:flex;align-items:center;gap:10px;font-weight:700}
.slabel::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,var(--border),transparent)}

/* â”€â”€ API KEY â”€â”€ */
.apikey-help{font-size:.66rem;color:var(--muted);line-height:1.6;margin-bottom:9px}
.apikey-help a{color:var(--gold-dark);text-decoration:none}
.apikey-row{display:flex;gap:8px}
.apikey-input{flex:1;background:var(--card2);border:1px solid var(--border);border-radius:3px;color:var(--text);font-family:'Rajdhani',sans-serif;font-size:14px;padding:10px 13px;outline:none;transition:border-color .2s;letter-spacing:.04em}
.apikey-input:focus{border-color:var(--gold-dark)}
.apikey-eye{background:var(--card2);border:1px solid var(--border);border-radius:3px;color:var(--muted);font-size:16px;padding:0 12px;cursor:pointer;transition:all .2s}
.apikey-eye:hover{border-color:var(--gold-dark)}
.apikey-status{font-size:.58rem;letter-spacing:.1em;margin-top:6px;text-transform:uppercase;min-height:16px}
.apikey-status.ok{color:var(--green)}.apikey-status.err{color:var(--red)}
.apikey-note{font-size:.56rem;color:var(--muted);margin-top:4px}

/* â”€â”€ FIELDS â”€â”€ */
label{display:block;font-size:.57rem;letter-spacing:.18em;color:var(--muted);text-transform:uppercase;margin-bottom:4px;margin-top:13px}
label:first-of-type{margin-top:0}
input[type=text],select,textarea{width:100%;background:var(--card2);border:1px solid var(--border);border-radius:3px;color:var(--text);font-family:'Rajdhani',sans-serif;font-size:14px;padding:10px 12px;outline:none;transition:border-color .2s}
input[type=text]:focus,select:focus,textarea:focus{border-color:var(--gold-dark)}
select option{background:#141414}
textarea{resize:vertical;min-height:120px}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
@media(max-width:640px){.grid2,.grid3{grid-template-columns:1fr}}

/* â”€â”€ MODE TOGGLE â”€â”€ */
.mode-toggle{display:flex;border:1px solid var(--border);border-radius:4px;overflow:hidden;margin-bottom:14px}
.mode-btn{flex:1;padding:10px;background:var(--card2);border:none;color:var(--muted);font-family:'Rajdhani',sans-serif;font-size:.6rem;letter-spacing:.16em;cursor:pointer;transition:all .2s;text-transform:uppercase;font-weight:600}
.mode-btn+.mode-btn{border-left:1px solid var(--border)}
.mode-btn.active{background:linear-gradient(135deg,var(--gold-dark),rgba(201,168,76,.4));color:var(--gold-light)}

/* â”€â”€ UPLOAD â”€â”€ */
.upload-zone{border:2px dashed var(--border);border-radius:5px;padding:26px 16px;text-align:center;cursor:pointer;transition:all .25s;background:var(--card2)}
.upload-zone:hover,.upload-zone.drag{border-color:var(--gold-dark);background:rgba(139,105,20,.05)}
.upload-zone.has-file{border-color:var(--gold);border-style:solid;background:rgba(201,168,76,.04)}
.upload-icon{font-size:2rem;display:block;margin-bottom:7px;opacity:.6}
.upload-title{font-size:.75rem;letter-spacing:.12em;color:var(--text);font-weight:600;text-transform:uppercase}
.upload-sub{font-size:.63rem;color:var(--muted);margin-top:3px}
.upload-types{font-size:.56rem;color:var(--gold-dark);margin-top:6px;letter-spacing:.09em;text-transform:uppercase}
.upload-clear{display:none;background:rgba(231,76,60,.1);border:1px solid rgba(231,76,60,.2);color:#e09090;font-size:.57rem;letter-spacing:.1em;padding:4px 11px;border-radius:3px;cursor:pointer;margin-top:8px;text-transform:uppercase;transition:all .2s}
.prog{display:none;margin-top:9px}
.prog-bar{height:3px;background:var(--border);border-radius:2px;overflow:hidden}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--gold-dark),var(--gold));width:0%;transition:width .3s}
.prog-txt{font-size:.57rem;color:var(--muted);margin-top:3px}
.extracted-box{display:none;background:var(--card2);border:1px solid var(--border);border-radius:4px;padding:11px;margin-top:10px}
.extracted-lbl{font-size:.55rem;letter-spacing:.18em;color:var(--gold-dark);text-transform:uppercase;margin-bottom:5px}
.extracted-txt{font-size:11px;color:var(--muted);max-height:80px;overflow-y:auto;white-space:pre-wrap;line-height:1.5}
#fileInput{position:absolute;width:1px;height:1px;opacity:0;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

/* â”€â”€ TONE â”€â”€ */
.tone-group{display:flex;gap:6px;flex-wrap:wrap}
.tone-btn{background:var(--card2);border:1px solid var(--border);border-radius:3px;color:var(--muted);font-family:'Rajdhani',sans-serif;font-size:.57rem;letter-spacing:.15em;padding:6px 11px;cursor:pointer;text-transform:uppercase;transition:all .2s}
.tone-btn:hover{border-color:var(--gold-dark);color:var(--gold-dark)}
.tone-btn.active{background:linear-gradient(135deg,var(--gold-dark),var(--gold));border-color:var(--gold);color:#000;font-weight:700}

/* â”€â”€ PRAZOS â”€â”€ */
.prazo-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:6px}
@media(max-width:600px){.prazo-grid{grid-template-columns:1fr 1fr}}
.prazo-card{background:var(--card2);border:1px solid var(--border);border-radius:4px;padding:10px 12px}
.prazo-nome{font-size:.55rem;letter-spacing:.1em;color:var(--muted);text-transform:uppercase}
.prazo-data{font-size:.85rem;color:var(--gold);font-family:'Cinzel',serif;margin-top:2px}
.prazo-dias{font-size:.58rem;color:var(--muted);margin-top:1px}
.prazo-dias.urgente{color:var(--red)}
.prazo-dias.atencao{color:var(--yellow)}
.prazo-dias.ok{color:var(--green)}

/* â”€â”€ EXEC BUTTON â”€â”€ */
.btn-exec{width:100%;padding:16px;background:linear-gradient(135deg,#6b4f0a,var(--gold),#6b4f0a);border:none;border-radius:4px;font-family:'Cinzel',serif;font-size:.72rem;letter-spacing:.26em;color:#000;font-weight:700;cursor:pointer;transition:all .3s;text-transform:uppercase;margin-top:14px;position:relative;overflow:hidden}
.btn-exec::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,transparent,rgba(255,255,255,.12),transparent);transform:translateX(-100%);transition:.5s}
.btn-exec:hover::after{transform:translateX(100%)}
.btn-exec:hover{transform:translateY(-1px);box-shadow:0 8px 28px rgba(201,168,76,.22)}
.btn-exec:disabled{opacity:.4;cursor:not-allowed;transform:none}

/* â”€â”€ LOADING â”€â”€ */
.loading{display:none;text-align:center;padding:56px 20px}
.loading.visible{display:block}
.spinner{width:48px;height:48px;margin:0 auto 14px;position:relative}
.spinner::before,.spinner::after{content:'';position:absolute;inset:0;border-radius:50%;border:2px solid transparent}
.spinner::before{border-top-color:var(--gold);animation:spin .9s linear infinite}
.spinner::after{border-bottom-color:var(--gold-dark);animation:spin 1.5s linear infinite reverse;inset:7px}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-title{font-size:.62rem;letter-spacing:.25em;color:var(--muted);text-transform:uppercase}
.loading-step{font-size:.58rem;letter-spacing:.13em;color:var(--gold-dark);margin-top:7px;min-height:18px}

/* â”€â”€ RESULT â”€â”€ */
.result-card{display:none}
.result-card.visible{display:block;animation:fadeUp .5s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

/* â”€â”€ RESUMO EXECUTIVO â”€â”€ */
.resumo-exec{background:linear-gradient(135deg,rgba(139,105,20,.1),rgba(201,168,76,.05));border:1px solid rgba(201,168,76,.2);border-radius:6px;padding:18px 20px;margin-bottom:16px}
.resumo-exec::before{content:'';display:block;height:1px;background:linear-gradient(90deg,transparent,var(--gold),transparent);margin-bottom:14px}
.resumo-titulo{font-family:'Cinzel',serif;font-size:.7rem;letter-spacing:.22em;color:var(--gold);text-transform:uppercase;margin-bottom:10px}
.resumo-itens{display:grid;grid-template-columns:1fr 1fr;gap:8px}
@media(max-width:500px){.resumo-itens{grid-template-columns:1fr}}
.resumo-item{background:rgba(0,0,0,.3);border-radius:4px;padding:8px 11px;border-left:2px solid var(--gold-dark)}
.resumo-item-label{font-size:.52rem;letter-spacing:.12em;color:var(--muted);text-transform:uppercase}
.resumo-item-val{font-size:.82rem;color:var(--text);margin-top:2px;font-weight:600}

/* â”€â”€ PROB â”€â”€ */
.prob-grid{display:grid;grid-template-columns:120px 1fr;gap:18px;align-items:start}
@media(max-width:480px){.prob-grid{grid-template-columns:1fr}}
.prob-value{font-family:'Cinzel',serif;font-size:3.4rem;font-weight:900;line-height:1}
.prob-value.high{color:var(--green)}.prob-value.medium{color:var(--yellow)}.prob-value.low{color:var(--red)}
.prob-class{font-size:.64rem;letter-spacing:.14em;text-transform:uppercase;margin-top:3px;font-weight:700}
.prob-bar-track{height:5px;background:var(--card2);border-radius:3px;overflow:hidden;border:1px solid var(--border);margin:12px 0 3px}
.prob-bar-fill{height:100%;border-radius:3px;transition:width 1.2s cubic-bezier(.16,1,.3,1);width:0%}
.prob-bar-fill.high{background:linear-gradient(90deg,#1e8449,var(--green))}.prob-bar-fill.medium{background:linear-gradient(90deg,#b7770d,var(--yellow))}.prob-bar-fill.low{background:linear-gradient(90deg,#922b21,var(--red))}
.score-row{display:flex;align-items:center;gap:9px;margin-bottom:7px}
.score-name{font-size:.55rem;letter-spacing:.09em;color:var(--muted);text-transform:uppercase;width:145px;flex-shrink:0}
.score-mini-bar{flex:1;height:3px;background:var(--card2);border-radius:2px;overflow:hidden}
.score-mini-fill{height:100%;background:linear-gradient(90deg,var(--gold-dark),var(--gold-light));border-radius:2px;transition:width 1.1s ease;width:0%}
.score-pct{font-size:.62rem;color:var(--gold);width:30px;text-align:right;font-family:'Cinzel',serif}

/* â”€â”€ AI TEXT â”€â”€ */
.ai-text{font-size:13px;line-height:1.9;color:#a09880;white-space:pre-wrap;font-family:'Rajdhani',sans-serif}

/* â”€â”€ CHAT â”€â”€ */
.chat-wrap{margin-top:6px}
.chat-messages{max-height:380px;overflow-y:auto;margin-bottom:12px;display:flex;flex-direction:column;gap:10px;padding-right:4px}
.chat-msg{border-radius:5px;padding:11px 14px;font-size:13px;line-height:1.75;max-width:92%}
.chat-msg.user{background:rgba(139,105,20,.15);border:1px solid rgba(139,105,20,.25);color:var(--text);align-self:flex-end}
.chat-msg.ai{background:var(--card2);border:1px solid var(--border);color:#a09880;align-self:flex-start;white-space:pre-wrap}
.chat-msg.ai.loading-msg{color:var(--muted);font-style:italic}
.chat-input-row{display:flex;gap:8px}
.chat-input{flex:1;background:var(--card2);border:1px solid var(--border);border-radius:3px;color:var(--text);font-family:'Rajdhani',sans-serif;font-size:14px;padding:10px 12px;outline:none;transition:border-color .2s;resize:none;min-height:44px;max-height:120px}
.chat-input:focus{border-color:var(--gold-dark)}
.btn-chat-send{background:linear-gradient(135deg,var(--gold-dark),var(--gold));border:none;border-radius:3px;color:#000;font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.15em;font-weight:700;padding:0 18px;cursor:pointer;transition:all .2s;flex-shrink:0}
.btn-chat-send:hover{transform:translateY(-1px);box-shadow:0 4px 14px rgba(201,168,76,.2)}
.btn-chat-send:disabled{opacity:.4;cursor:not-allowed;transform:none}
.chat-sugest{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}
.chat-sugest-btn{background:var(--card2);border:1px solid var(--border);border-radius:3px;color:var(--muted);font-family:'Rajdhani',sans-serif;font-size:.57rem;letter-spacing:.1em;padding:5px 10px;cursor:pointer;text-transform:uppercase;transition:all .2s;white-space:nowrap}
.chat-sugest-btn:hover{border-color:var(--gold-dark);color:var(--gold-dark)}

/* â”€â”€ DOWNLOAD â”€â”€ */
.dl-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
@media(max-width:480px){.dl-grid{grid-template-columns:1fr}}
.btn-dl{width:100%;padding:13px;border:none;border-radius:4px;font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.15em;font-weight:700;cursor:pointer;transition:all .3s;text-transform:uppercase;display:flex;align-items:center;justify-content:center;gap:7px}
.btn-dl.word{background:linear-gradient(135deg,#0f2a52,#1a4a8a);color:#fff;border:1px solid #1a4a8a}
.btn-dl.pdf{background:linear-gradient(135deg,#4a0f0f,#8a1a1a);color:#fff;border:1px solid #8a1a1a}
.btn-dl:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.4)}
.btn-dl:disabled{opacity:.4;cursor:not-allowed;transform:none}
.dl-status{font-size:.58rem;letter-spacing:.09em;color:var(--muted);text-align:center;padding:6px 0 0;min-height:20px;text-transform:uppercase}

/* â”€â”€ HISTÃ“RICO â”€â”€ */
.hist-panel{display:none;position:fixed;top:0;right:0;width:360px;max-width:95vw;height:100vh;background:#0c0c0c;border-left:1px solid var(--border);z-index:900;flex-direction:column;animation:slideIn .25s ease}
.hist-panel.open{display:flex}
@keyframes slideIn{from{transform:translateX(100%)}to{transform:translateX(0)}}
.hist-header{padding:16px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.hist-title{font-family:'Cinzel',serif;font-size:.72rem;letter-spacing:.2em;color:var(--gold);text-transform:uppercase}
.hist-close{background:transparent;border:1px solid var(--border);border-radius:3px;color:var(--muted);font-size:16px;width:30px;height:30px;cursor:pointer;transition:all .2s}
.hist-close:hover{border-color:var(--red);color:var(--red)}
.hist-list{flex:1;overflow-y:auto;padding:12px}
.hist-item{background:var(--card);border:1px solid var(--border);border-radius:4px;padding:12px;margin-bottom:9px;cursor:pointer;transition:all .2s}
.hist-item:hover{border-color:var(--gold-dark);background:rgba(139,105,20,.07)}
.hist-item-titulo{font-size:.7rem;font-weight:600;color:var(--text);margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.hist-item-meta{font-size:.58rem;color:var(--muted);display:flex;gap:10px}
.hist-item-prob{font-family:'Cinzel',serif;font-size:.8rem}
.hist-item-prob.high{color:var(--green)}.hist-item-prob.medium{color:var(--yellow)}.hist-item-prob.low{color:var(--red)}
.hist-empty{text-align:center;color:var(--muted);font-size:.68rem;padding:40px 20px}
.hist-footer{padding:12px 16px;border-top:1px solid var(--border);flex-shrink:0}
.btn-hist-clear{width:100%;padding:9px;background:transparent;border:1px solid rgba(231,76,60,.25);border-radius:3px;color:rgba(231,76,60,.6);font-family:'Rajdhani',sans-serif;font-size:.6rem;letter-spacing:.15em;cursor:pointer;text-transform:uppercase;transition:all .2s}
.btn-hist-clear:hover{border-color:var(--red);color:var(--red)}
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:800}
.overlay.open{display:block}

/* â”€â”€ CHECKLIST â”€â”€ */
.checklist{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:8px}
@media(max-width:500px){.checklist{grid-template-columns:1fr}}
.check-item{display:flex;align-items:center;gap:8px;background:var(--card2);border:1px solid var(--border);border-radius:3px;padding:8px 10px;cursor:pointer;transition:all .2s;user-select:none}
.check-item:hover{border-color:var(--gold-dark)}
.check-item.checked{border-color:rgba(46,204,113,.4);background:rgba(46,204,113,.05)}
.check-box{width:14px;height:14px;border:1px solid var(--border);border-radius:2px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:10px;transition:all .2s}
.check-item.checked .check-box{background:var(--green);border-color:var(--green);color:#000}
.check-label{font-size:.62rem;color:var(--muted);letter-spacing:.06em;transition:color .2s}
.check-item.checked .check-label{color:var(--text)}
.check-progress{height:3px;background:var(--border);border-radius:2px;margin-top:10px;overflow:hidden}
.check-progress-fill{height:100%;background:linear-gradient(90deg,var(--gold-dark),var(--green));border-radius:2px;transition:width .4s ease}
.check-status{font-size:.58rem;color:var(--muted);margin-top:4px}

/* â”€â”€ PRAZOS CALC â”€â”€ */
.prazo-input-row{display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap}
.prazo-input-row > div{flex:1;min-width:130px}
.btn-calc-prazo{background:linear-gradient(135deg,var(--gold-dark),rgba(201,168,76,.5));border:none;border-radius:3px;color:#000;font-family:'Cinzel',serif;font-size:.58rem;letter-spacing:.14em;font-weight:700;padding:10px 16px;cursor:pointer;white-space:nowrap;transition:all .2s}
.btn-calc-prazo:hover{transform:translateY(-1px)}
.prazo-resultado{display:none;margin-top:12px}

/* â”€â”€ NOVA ANÃLISE â”€â”€ */
.btn-nova{width:100%;padding:11px;background:transparent;border:1px solid var(--border);border-radius:4px;font-family:'Rajdhani',sans-serif;font-size:.64rem;letter-spacing:.26em;color:var(--muted);cursor:pointer;text-transform:uppercase;transition:all .2s;margin-top:4px}
.btn-nova:hover{border-color:var(--gold-dark);color:var(--gold)}

/* â”€â”€ DISC â”€â”€ */
.disc{background:rgba(201,168,76,.03);border:1px solid rgba(201,168,76,.08);border-radius:4px;padding:10px 13px;margin-bottom:14px;font-size:.65rem;color:var(--muted);line-height:1.6}
.disc strong{color:var(--gold-dark)}
.chars{font-size:.57rem;color:var(--muted);text-align:right;margin-top:3px}
.chars span{color:var(--gold-dark)}
.hidden{display:none!important}
.copy-prompt-card{background:linear-gradient(135deg,rgba(139,105,20,.07),rgba(201,168,76,.03));border:1px solid rgba(201,168,76,.2);border-radius:6px;padding:18px;margin-bottom:16px;position:relative}
.copy-prompt-card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--gold),transparent)}
.prompt-preview{background:var(--bg);border:1px solid var(--border);border-radius:4px;padding:12px;font-size:11px;color:var(--muted);white-space:pre-wrap;max-height:180px;overflow-y:auto;line-height:1.65;font-family:'Rajdhani',sans-serif;margin:10px 0}
.btn-copy{width:100%;padding:13px;background:linear-gradient(135deg,rgba(201,168,76,.13),rgba(201,168,76,.06));border:1px solid var(--gold-dark);border-radius:4px;font-family:'Cinzel',serif;font-size:.68rem;letter-spacing:.2em;color:var(--gold-light);font-weight:700;cursor:pointer;transition:all .3s;text-transform:uppercase;display:flex;align-items:center;justify-content:center;gap:9px}
.btn-copy:hover{border-color:var(--gold);transform:translateY(-1px)}
.btn-copy.copied{background:linear-gradient(135deg,rgba(46,204,113,.13),rgba(46,204,113,.06));border-color:var(--green);color:var(--green)}
.copy-hint{font-size:.58rem;color:var(--muted);text-align:center;margin-top:7px}
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="topbar-logo">V9 PRO</div>
  <div class="topbar-actions">
    <button class="btn-hist" onclick="toggleHist()">
      ğŸ“‹ HistÃ³rico <span class="hist-count" id="histCount">0</span>
    </button>
  </div>
</div>

<!-- HISTÃ“RICO PAINEL -->
<div class="overlay" id="overlay" onclick="toggleHist()"></div>
<div class="hist-panel" id="histPanel">
  <div class="hist-header">
    <div class="hist-title">â—ˆ AnÃ¡lises Salvas</div>
    <button class="hist-close" onclick="toggleHist()">âœ•</button>
  </div>
  <div class="hist-list" id="histList"></div>
  <div class="hist-footer">
    <button class="btn-hist-clear" onclick="limparHistorico()">ğŸ—‘ Limpar HistÃ³rico</button>
  </div>
</div>

<header>
  <div class="logo-text">V9 POWER EDITION</div>
  <div class="logo-sub">Plataforma JurÃ­dica Profissional Â· Advogados &amp; EscritÃ³rios</div>
  <div class="logo-badges">
    <span class="badge">Zero AlucinaÃ§Ã£o</span>
    <span class="badge">Word &amp; PDF</span>
    <span class="badge">Chat com IA</span>
    <span class="badge">Prazos Processuais</span>
  </div>
</header>

<div class="container">

<!-- API KEY -->
<div class="card">
  <div class="slabel">ğŸ”‘ Chave de API Gemini</div>
  <div class="apikey-help">
    GrÃ¡tis em <a href="https://aistudio.google.com/app/apikey" target="_blank">aistudio.google.com</a>
    â†’ Get API Key â†’ Create API key. Salva automaticamente no seu navegador.
  </div>
  <div class="apikey-row">
    <input class="apikey-input" id="apiKeyInput" type="password" placeholder="AIza..." oninput="checkKey()" autocomplete="off" spellcheck="false"/>
    <button class="apikey-eye" id="apiKeyEye" onclick="toggleEye()">ğŸ‘</button>
  </div>
  <div class="apikey-status" id="apiKeyStatus"></div>
  <div class="apikey-note">ğŸ”’ Sua chave fica salva sÃ³ no seu navegador â€” nunca sai do dispositivo.</div>
</div>

<div class="disc">
  <strong>âš– V9 PRO:</strong> AnÃ¡lise jurÃ­dica profissional para advogados e escritÃ³rios.
  A IA <strong>NUNCA inventa dados</strong>. NÃ£o substitui advogado habilitado.
</div>

<!-- FORMULÃRIO -->
<div class="card" id="inputCard">
  <div class="slabel">â—ˆ IdentificaÃ§Ã£o do Caso</div>

  <!-- Cliente + Processo -->
  <div class="grid2">
    <div>
      <label>Cliente / Representado</label>
      <input type="text" id="nomeCliente" placeholder="Nome do cliente..."/>
    </div>
    <div>
      <label>NÂº do Processo <small style="color:var(--muted)">(opcional)</small></label>
      <input type="text" id="numProcesso" placeholder="0000000-00.0000.0.00.0000"/>
    </div>
  </div>

  <div class="slabel" style="margin-top:20px">â—ˆ Modo de AnÃ¡lise</div>

  <div class="mode-toggle">
    <button class="mode-btn active" id="modeUploadBtn" onclick="setMode('upload')">ğŸ“ Anexar Documento</button>
    <button class="mode-btn" id="modeManualBtn" onclick="setMode('manual')">âœï¸ Digitar Dados</button>
  </div>

  <!-- UPLOAD -->
  <div id="uploadSection">
    <div class="upload-zone" id="uploadZone" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="dropFile(event)">
      <span class="upload-icon" id="uploadIcon">ğŸ“„</span>
      <div class="upload-title" id="uploadTitle">Clique aqui ou arraste o arquivo</div>
      <div class="upload-sub" id="uploadSub">Contrato, PetiÃ§Ã£o, SentenÃ§a, NotificaÃ§Ã£o, Laudo...</div>
      <div class="upload-types" id="uploadTypes">PDF Â· Word (.docx) Â· Imagem (JPG/PNG) Â· TXT Â· AtÃ© 150MB</div>
      <button class="upload-clear" id="uploadClear" onclick="clearFile(event)" type="button">âœ• Remover</button>
    </div>
    <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.webp" onchange="handleFile(this.files[0])">
    <div class="prog" id="prog">
      <div class="prog-bar"><div class="prog-fill" id="progFill"></div></div>
      <div class="prog-txt" id="progTxt"></div>
    </div>
    <div class="extracted-box" id="extractedBox">
      <div class="extracted-lbl">â—ˆ ConteÃºdo ExtraÃ­do</div>
      <div class="extracted-txt" id="extractedTxt"></div>
    </div>
    <label style="margin-top:13px">InstruÃ§Ãµes Adicionais <small style="color:var(--muted)">(opcional)</small></label>
    <textarea id="extraContext" style="min-height:65px" placeholder="Ex: Foque na clÃ¡usula de multa. Analise o risco para o credor..."></textarea>
  </div>

  <!-- MANUAL -->
  <div id="manualSection" class="hidden">
    <div class="grid2">
      <div>
        <label>Ãrea do Direito *</label>
        <select id="areaDir">
          <option value="">Selecione...</option>
          <option>Direito Trabalhista</option><option>Direito Civil</option>
          <option>Direito do Consumidor</option><option>Direito PrevidenciÃ¡rio</option>
          <option>Direito de FamÃ­lia</option><option>Direito TributÃ¡rio</option>
          <option>Direito Empresarial</option><option>Direito Penal</option>
          <option>Direito Administrativo</option><option>Direito Ambiental</option>
          <option>Direito BancÃ¡rio</option><option>Direito Digital</option>
          <option>Direito ImobiliÃ¡rio</option><option>Direito MÃ©dico</option>
        </select>
      </div>
      <div>
        <label>Tipo de AÃ§Ã£o / PeÃ§a</label>
        <input type="text" id="tipoAcao" placeholder="Ex: ReclamaÃ§Ã£o Trabalhista..."/>
      </div>
    </div>
    <div class="grid2">
      <div>
        <label>Polo Ativo (Autor)</label>
        <input type="text" id="autor" placeholder="Ex: Empregado, Consumidor..."/>
      </div>
      <div>
        <label>Polo Passivo (RÃ©u)</label>
        <input type="text" id="reu" placeholder="Ex: Empresa XYZ, Banco..."/>
      </div>
    </div>
    <label>Pedidos Principais</label>
    <input type="text" id="pedidos" placeholder="Ex: Horas extras, danos morais, FGTS..."/>
    <div class="grid2">
      <div>
        <label>Tribunal / InstÃ¢ncia</label>
        <select id="tribunal">
          <option value="">Selecione...</option>
          <option>1Âª InstÃ¢ncia â€“ Vara do Trabalho</option>
          <option>1Âª InstÃ¢ncia â€“ Vara CÃ­vel</option>
          <option>TRT (Tribunal Regional do Trabalho)</option>
          <option>TJ (Tribunal de JustiÃ§a Estadual)</option>
          <option>TST (Tribunal Superior do Trabalho)</option>
          <option>STJ (Superior Tribunal de JustiÃ§a)</option>
          <option>STF (Supremo Tribunal Federal)</option>
        </select>
      </div>
      <div>
        <label>Valor Est. da Causa (R$)</label>
        <input type="text" id="valorCausa" placeholder="Ex: 50.000,00"/>
      </div>
    </div>
    <label>Fatos, Provas e Argumentos *</label>
    <textarea id="fatos" placeholder="Descreva os fatos, provas disponÃ­veis, documentos, histÃ³rico do caso..."></textarea>
    <div class="chars"><span id="charsCount">0</span> caracteres</div>
  </div>

  <!-- TOM -->
  <label style="margin-top:16px">Tom da AnÃ¡lise</label>
  <div class="tone-group">
    <button class="tone-btn active" data-tone="imparcial">Imparcial</button>
    <button class="tone-btn" data-tone="favoravel">FavorÃ¡vel ao Autor</button>
    <button class="tone-btn" data-tone="defensivo">Defensivo ao RÃ©u</button>
    <button class="tone-btn" data-tone="estrategico">EstratÃ©gico</button>
  </div>

  <button class="btn-exec" id="btnExec" onclick="executar()">
    âš– EXECUTAR ANÃLISE JURÃDICA V9 PRO
  </button>
</div>

<!-- CALCULADORA DE PRAZOS -->
<div class="card">
  <div class="slabel">â± Calculadora de Prazos Processuais</div>
  <div class="prazo-input-row">
    <div>
      <label>Data do Ato / IntimaÃ§Ã£o</label>
      <input type="text" id="prazoDataAto" placeholder="DD/MM/AAAA" maxlength="10" oninput="maskData(this)"/>
    </div>
    <div>
      <label>Tipo de Prazo</label>
      <select id="prazoTipo">
        <option value="15">ContestaÃ§Ã£o â€“ 15 dias (CÃ­vel)</option>
        <option value="30">ReclamaÃ§Ã£o Trabalhista â€“ 30 dias</option>
        <option value="5">Embargos de DeclaraÃ§Ã£o â€“ 5 dias</option>
        <option value="15">ApelaÃ§Ã£o â€“ 15 dias</option>
        <option value="15">Recurso OrdinÃ¡rio Trabalhista â€“ 8 dias</option>
        <option value="10">Agravo de Instrumento â€“ 15 dias</option>
        <option value="30">Recurso Especial/ExtraordinÃ¡rio â€“ 15 dias</option>
        <option value="60">Mandado de SeguranÃ§a â€“ 120 dias</option>
        <option value="custom">Personalizado...</option>
      </select>
    </div>
    <div id="prazoCustomDiv" class="hidden">
      <label>Dias</label>
      <input type="text" id="prazoCustomDias" placeholder="Ex: 10"/>
    </div>
    <button class="btn-calc-prazo" onclick="calcularPrazo()">Calcular</button>
  </div>
  <div class="prazo-resultado" id="prazoResultado"></div>
</div>

<!-- CHECKLIST DE DOCUMENTOS -->
<div class="card">
  <div class="slabel">ğŸ“‹ Checklist de Documentos</div>
  <div class="grid2" style="margin-bottom:10px">
    <div>
      <label>Tipo de AÃ§Ã£o para Checklist</label>
      <select id="checklistTipo" onchange="gerarChecklist()">
        <option value="">Selecione para gerar...</option>
        <option value="trabalhista">ReclamaÃ§Ã£o Trabalhista</option>
        <option value="indenizacao">AÃ§Ã£o de IndenizaÃ§Ã£o</option>
        <option value="consumidor">Direito do Consumidor</option>
        <option value="previdenciario">PrevidenciÃ¡rio / INSS</option>
        <option value="familia">Direito de FamÃ­lia</option>
        <option value="cobranca">AÃ§Ã£o de CobranÃ§a</option>
        <option value="contrato">RevisÃ£o de Contrato</option>
      </select>
    </div>
  </div>
  <div id="checklistArea"></div>
</div>

<!-- LOADING -->
<div class="loading" id="loading">
  <div class="spinner"></div>
  <p class="loading-title">Executando AnÃ¡lise V9 Pro</p>
  <p class="loading-step" id="loadingStep">Inicializando...</p>
</div>

<!-- RESULTADO -->
<div class="result-card" id="resultCard">

  <!-- RESUMO EXECUTIVO -->
  <div class="resumo-exec" id="resumoExec">
    <div class="resumo-titulo">â—ˆ Resumo Executivo</div>
    <div class="resumo-itens" id="resumoItens"></div>
  </div>

  <!-- PROBABILIDADE -->
  <div class="card">
    <div class="slabel">â—ˆ Probabilidade de ÃŠxito</div>
    <div class="prob-grid">
      <div>
        <div style="font-size:.52rem;letter-spacing:.18em;color:var(--muted);text-transform:uppercase;margin-bottom:3px">Estimativa Global</div>
        <div class="prob-value" id="probValue">â€”</div>
        <div class="prob-class" id="probClass"></div>
      </div>
      <div>
        <div class="prob-bar-track"><div class="prob-bar-fill" id="probBar"></div></div>
        <div id="scoreBreakdown"></div>
      </div>
    </div>
    <div style="margin-top:9px;font-size:.57rem;color:var(--muted)">* Estimativa analÃ­tica. NÃ£o garante resultado processual.</div>
  </div>

  <!-- ANÃLISE COMPLETA -->
  <div class="card">
    <div class="slabel">â—ˆ AnÃ¡lise JurÃ­dica Completa</div>
    <div class="ai-text" id="aiText"></div>
  </div>

  <!-- CHAT COM IA -->
  <div class="card">
    <div class="slabel">ğŸ’¬ Chat com a IA sobre este Caso</div>
    <p style="font-size:12px;color:var(--muted);margin-bottom:10px">FaÃ§a perguntas especÃ­ficas sobre o caso analisado. A IA tem todo o contexto.</p>
    <div class="chat-sugest" id="chatSugest">
      <button class="chat-sugest-btn" onclick="chatSugest(this)">Qual a melhor estratÃ©gia para acordo?</button>
      <button class="chat-sugest-btn" onclick="chatSugest(this)">Quais provas sÃ£o indispensÃ¡veis?</button>
      <button class="chat-sugest-btn" onclick="chatSugest(this)">Qual o risco de perder?</button>
      <button class="chat-sugest-btn" onclick="chatSugest(this)">Estime os honorÃ¡rios advocatÃ­cios</button>
      <button class="chat-sugest-btn" onclick="chatSugest(this)">HÃ¡ prescriÃ§Ã£o ou decadÃªncia?</button>
      <button class="chat-sugest-btn" onclick="chatSugest(this)">Elabore um esboÃ§o de petiÃ§Ã£o inicial</button>
    </div>
    <div class="chat-wrap">
      <div class="chat-messages" id="chatMessages"></div>
      <div class="chat-input-row">
        <textarea class="chat-input" id="chatInput" placeholder="Pergunte algo sobre o caso..." rows="1" onkeydown="chatKeydown(event)"></textarea>
        <button class="btn-chat-send" id="btnChatSend" onclick="enviarChat()">ENVIAR</button>
      </div>
    </div>
  </div>

  <!-- DOWNLOAD -->
  <div class="card">
    <div class="slabel">â—ˆ Download do Documento</div>
    <p style="font-size:12px;color:var(--muted);margin-bottom:2px">Documento profissional com capa, anÃ¡lise completa, fundamentaÃ§Ã£o e estratÃ©gia.</p>
    <div class="dl-grid">
      <button class="btn-dl word" id="btnWord" onclick="dlWord()">ğŸ“„ Baixar Word (.docx)</button>
      <button class="btn-dl pdf" id="btnPdf" onclick="dlPDF()">ğŸ“• Baixar PDF</button>
    </div>
    <div class="dl-status" id="dlStatus"></div>
  </div>

  <!-- COPIAR PROMPT -->
  <div class="copy-prompt-card">
    <div class="slabel">ğŸ“‹ Prompt para Outra IA</div>
    <p style="font-size:12px;color:var(--muted);margin-bottom:4px">Prompt completo para aprofundar a anÃ¡lise no ChatGPT, Claude ou outra IA.</p>
    <div class="prompt-preview" id="promptPreview"></div>
    <button class="btn-copy" id="btnCopy" onclick="copyPrompt()">ğŸ“‹ COPIAR PROMPT COMPLETO</button>
    <div class="copy-hint" id="copyHint">Cole no ChatGPT, Gemini, Claude ou qualquer IA para continuar</div>
  </div>

  <button class="btn-nova" onclick="reset()">â† NOVA ANÃLISE</button>
</div>

</div><!-- /container -->

<script>
'use strict';

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentMode = 'upload';
let uploadedFile = null;
let extractedContent = '';
let extractedBase64 = '';
let extractedMime = '';
let analysisData = null;
let chatHistory = [];

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded', () => {
  // Carregar chave salva
  try { const k = localStorage.getItem('v9_apikey'); if(k){ document.getElementById('apiKeyInput').value=k; checkKey(); } } catch(e){}

  // Upload zone click
  const zone = document.getElementById('uploadZone');
  const fi = document.getElementById('fileInput');
  zone.addEventListener('click', e => {
    if(e.target.id==='uploadClear'||e.target.closest('#uploadClear')) return;
    fi.click();
  });

  // Tone buttons
  document.querySelectorAll('.tone-btn').forEach(b => {
    b.addEventListener('click', () => {
      document.querySelectorAll('.tone-btn').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
    });
  });

  // Char counter
  document.getElementById('fatos').addEventListener('input', function(){
    document.getElementById('charsCount').textContent = this.value.length;
  });

  // Prazo tipo custom
  document.getElementById('prazoTipo').addEventListener('change', function(){
    document.getElementById('prazoCustomDiv').classList.toggle('hidden', this.value !== 'custom');
  });

  // Atualizar contagem do histÃ³rico
  atualizarContHist();
});

// â”€â”€ API KEY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkKey(){
  const k = document.getElementById('apiKeyInput').value.trim();
  const st = document.getElementById('apiKeyStatus');
  if(!k){ st.textContent=''; st.className='apikey-status'; return; }
  if(k.startsWith('AIza') && k.length > 20){
    st.textContent = 'âœ“ Chave vÃ¡lida â€” salva no navegador';
    st.className = 'apikey-status ok';
    try{ localStorage.setItem('v9_apikey', k); }catch(e){}
  } else {
    st.textContent = 'âœ— Formato invÃ¡lido â€” deve comeÃ§ar com AIza';
    st.className = 'apikey-status err';
  }
}
function toggleEye(){
  const inp = document.getElementById('apiKeyInput');
  inp.type = inp.type==='password' ? 'text' : 'password';
  document.getElementById('apiKeyEye').textContent = inp.type==='password' ? 'ğŸ‘' : 'ğŸ™ˆ';
}

// â”€â”€ MODE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setMode(m){
  currentMode = m;
  document.getElementById('modeUploadBtn').classList.toggle('active', m==='upload');
  document.getElementById('modeManualBtn').classList.toggle('active', m==='manual');
  document.getElementById('uploadSection').classList.toggle('hidden', m==='manual');
  document.getElementById('manualSection').classList.toggle('hidden', m==='upload');
}

// â”€â”€ DRAG & DROP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function dragOver(e){ e.preventDefault(); e.stopPropagation(); document.getElementById('uploadZone').classList.add('drag'); }
function dragLeave(e){ e.preventDefault(); document.getElementById('uploadZone').classList.remove('drag'); }
function dropFile(e){ e.preventDefault(); e.stopPropagation(); dragLeave(e); const f=e.dataTransfer.files[0]; if(f) handleFile(f); }

// â”€â”€ FILE HANDLER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function handleFile(file){
  if(!file) return;
  if(file.size > 150*1024*1024){ alert('Arquivo muito grande. MÃ¡ximo: 150MB'); return; }
  uploadedFile=file; extractedContent=''; extractedBase64=''; extractedMime='';
  const z=document.getElementById('uploadZone');
  z.classList.add('has-file');
  document.getElementById('uploadIcon').textContent = icon(file.name);
  document.getElementById('uploadTitle').textContent = file.name;
  document.getElementById('uploadSub').textContent = fsize(file.size);
  document.getElementById('uploadTypes').style.display='none';
  document.getElementById('uploadClear').style.display='inline-block';
  prog(true,'Lendo arquivo...',10);
  const ext = file.name.split('.').pop().toLowerCase();
  try{
    if(ext==='txt'){ extractedContent=await rText(file); prog(true,'Texto extraÃ­do!',100); }
    else if(['doc','docx'].includes(ext)){
      prog(true,'Extraindo texto do Word...',30);
      const ab=await rBuffer(file);
      const r=await mammoth.extractRawText({arrayBuffer:ab});
      extractedContent=r.value; prog(true,'Texto extraÃ­do!',100);
    }
    else if(ext==='pdf'){ prog(true,'PDF pronto!',100); extractedBase64=await rB64(file); extractedMime='application/pdf'; }
    else if(['jpg','jpeg','png','webp'].includes(ext)){ prog(true,'Imagem pronta!',100); extractedBase64=await rB64(file); extractedMime=file.type||'image/jpeg'; }
    else { alert('Formato nÃ£o suportado. Use: PDF, DOCX, TXT, JPG, PNG.'); clearFile(null); return; }
    const box=document.getElementById('extractedBox'); box.style.display='block';
    if(extractedContent){
      document.getElementById('extractedTxt').textContent = extractedContent.substring(0,400)+(extractedContent.length>400?'â€¦':'');
    } else {
      document.getElementById('extractedTxt').textContent = 'âœ“ Arquivo carregado â€” a IA vai analisar o conteÃºdo';
    }
    document.getElementById('uploadSub').textContent='âœ“ Pronto para anÃ¡lise';
  }catch(e){ alert('Erro ao ler: '+e.message); clearFile(null); }
  setTimeout(()=>prog(false),1200);
}
function clearFile(e){
  if(e){ e.stopPropagation(); e.preventDefault(); }
  uploadedFile=null; extractedContent=''; extractedBase64=''; extractedMime='';
  document.getElementById('fileInput').value='';
  const z=document.getElementById('uploadZone'); z.classList.remove('has-file','drag');
  document.getElementById('uploadIcon').textContent='ğŸ“„';
  document.getElementById('uploadTitle').textContent='Clique aqui ou arraste o arquivo';
  document.getElementById('uploadSub').textContent='Contrato, PetiÃ§Ã£o, SentenÃ§a, NotificaÃ§Ã£o, Laudo...';
  document.getElementById('uploadTypes').style.display='';
  document.getElementById('uploadClear').style.display='none';
  document.getElementById('extractedBox').style.display='none';
  prog(false);
}
function prog(show,txt='',pct=0){
  document.getElementById('prog').style.display=show?'block':'none';
  if(txt) document.getElementById('progTxt').textContent=txt;
  document.getElementById('progFill').style.width=pct+'%';
}
function icon(n){ const e=n.split('.').pop().toLowerCase(); return e==='pdf'?'ğŸ“•':['doc','docx'].includes(e)?'ğŸ“˜':['jpg','jpeg','png','webp'].includes(e)?'ğŸ–¼ï¸':'ğŸ“„'; }
function fsize(b){ return b<1048576?(b/1024).toFixed(1)+' KB':(b/1048576).toFixed(1)+' MB'; }
function rText(f){ return new Promise((s,r)=>{const x=new FileReader();x.onload=e=>s(e.target.result);x.onerror=()=>r(new Error('Falha'));x.readAsText(f,'UTF-8');}); }
function rBuffer(f){ return new Promise((s,r)=>{const x=new FileReader();x.onload=e=>s(e.target.result);x.onerror=()=>r(new Error('Falha'));x.readAsArrayBuffer(f);}); }
function rB64(f){ return new Promise((s,r)=>{const x=new FileReader();x.onload=e=>s(e.target.result.split(',')[1]);x.onerror=()=>r(new Error('Falha'));x.readAsDataURL(f);}); }

// â”€â”€ CALCULADORA DE PRAZOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function maskData(el){
  let v=el.value.replace(/\D/g,'');
  if(v.length>=3) v=v.substring(0,2)+'/'+v.substring(2);
  if(v.length>=6) v=v.substring(0,5)+'/'+v.substring(5,9);
  el.value=v;
}
function calcularPrazo(){
  const dataStr = document.getElementById('prazoDataAto').value.trim();
  if(!dataStr || dataStr.length<10){ alert('Informe a data no formato DD/MM/AAAA'); return; }
  const [dd,mm,aaaa] = dataStr.split('/');
  const dataAto = new Date(parseInt(aaaa), parseInt(mm)-1, parseInt(dd));
  if(isNaN(dataAto.getTime())){ alert('Data invÃ¡lida'); return; }

  let sel = document.getElementById('prazoTipo');
  let dias = parseInt(sel.value);
  if(sel.value==='custom'){
    dias = parseInt(document.getElementById('prazoCustomDias').value);
    if(isNaN(dias)||dias<1){ alert('Informe o nÃºmero de dias'); return; }
  }
  // Prazos especiais
  const prazosEspeciais = {
    '15': {nome:'ContestaÃ§Ã£o',base:15},
    '30': {nome:'ReclamaÃ§Ã£o Trabalhista',base:30},
    '5':  {nome:'Embargos de DeclaraÃ§Ã£o',base:5},
  };

  // Calcula vencimento (dias corridos â€” simplificado, sem feriados)
  const venc = new Date(dataAto);
  venc.setDate(venc.getDate() + dias);
  // Se cair no fim de semana, avanÃ§a para segunda
  while(venc.getDay()===0||venc.getDay()===6) venc.setDate(venc.getDate()+1);

  const hoje = new Date(); hoje.setHours(0,0,0,0);
  const diffMs = venc - hoje;
  const diffDias = Math.ceil(diffMs/(1000*60*60*24));

  const fmt = d => d.toLocaleDateString('pt-BR',{day:'2-digit',month:'2-digit',year:'numeric',weekday:'long'});

  let urgClass = diffDias<=3?'urgente':diffDias<=10?'atencao':'ok';
  let urgTxt = diffDias<0?'âš  PRAZO VENCIDO':diffDias===0?'âš  VENCE HOJE':diffDias===1?'âš  VENCE AMANHÃƒ':`${diffDias} dias restantes`;

  const res = document.getElementById('prazoResultado');
  res.style.display='block';
  res.innerHTML = `
    <div class="prazo-grid">
      <div class="prazo-card">
        <div class="prazo-nome">Data do Ato</div>
        <div class="prazo-data">${dataStr}</div>
        <div class="prazo-dias">${fmt(dataAto)}</div>
      </div>
      <div class="prazo-card">
        <div class="prazo-nome">Prazo (${dias} dias Ãºteis)</div>
        <div class="prazo-data">${venc.toLocaleDateString('pt-BR')}</div>
        <div class="prazo-dias">${fmt(venc)}</div>
      </div>
      <div class="prazo-card">
        <div class="prazo-nome">SituaÃ§Ã£o</div>
        <div class="prazo-data ${urgClass}" style="font-size:1.1rem">${diffDias<0?'VENCIDO':diffDias+'d'}</div>
        <div class="prazo-dias ${urgClass}">${urgTxt}</div>
      </div>
    </div>
    <div style="font-size:.58rem;color:var(--muted);margin-top:8px">âš  CÃ¡lculo simplificado â€” fins de semana ajustados. Confirme feriados locais.</div>`;
}

// â”€â”€ CHECKLIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CHECKLISTS = {
  trabalhista:['Carteira de Trabalho (CTPS)','Contracheques / Holerites','Contrato de Trabalho','Comprovante de rescisÃ£o / TRCT','Extrato FGTS','Comprovante de fÃ©rias','Folhas de ponto','Comprovante de registro sindical','Documentos de identidade','Comprovante de endereÃ§o'],
  indenizacao:['Documentos de identidade','Boletim de OcorrÃªncia (se houver)','Laudos mÃ©dicos / Atestados','Fotos dos danos','OrÃ§amentos de reparo','Comprovantes de despesas','Testemunhas (nomes e contatos)','Prints / Provas digitais','HistÃ³rico de comunicaÃ§Ãµes','Comprovante de endereÃ§o'],
  consumidor:['Nota fiscal / Cupom fiscal','Contrato de compra ou serviÃ§o','Fotos do produto com defeito','Comprovantes de pagamento','E-mails / Mensagens com empresa','Laudo tÃ©cnico (se houver)','Protocolo de reclamaÃ§Ã£o','Print do site / Oferta','Comprovante de devoluÃ§Ã£o','Documentos pessoais'],
  previdenciario:['CPF e RG','Carteira de Trabalho','CNIS (Extrato PrevidenciÃ¡rio)','Laudos mÃ©dicos atualizados','Exames e atestados','DeclaraÃ§Ã£o do INSS de indeferimento','ProcuraÃ§Ã£o para advogado','Comprovante de residÃªncia','HistÃ³rico de contribuiÃ§Ãµes','FormulÃ¡rios INSS preenchidos'],
  familia:['CertidÃ£o de casamento','Documentos dos filhos','CertidÃ£o de nascimento','Comprovantes de renda de ambas as partes','Comprovante de residÃªncia','Documentos de bens imÃ³veis','Extratos bancÃ¡rios','Escritura de divÃ³rcio anterior (se houver)','Acordo extrajudicial (se houver)','Documentos de dependentes'],
  cobranca:['Contrato assinado','Duplicatas / Notas promissÃ³rias','Comprovantes de entrega','Extratos de pagamento','E-mails e notificaÃ§Ãµes enviadas','CertidÃ£o de protesto (se houver)','Documentos da empresa devedora','ProcuraÃ§Ã£o','Planilha de dÃ©bito atualizada','Documentos pessoais do credor'],
  contrato:['Contrato original completo','Aditivos e anexos','Comprovantes de pagamento','E-mails sobre negociaÃ§Ã£o','Atas de reuniÃ£o','Documentos das partes','Laudos ou pareceres tÃ©cnicos','Contratos similares para comparaÃ§Ã£o','CorrespondÃªncias formais','Extratos bancÃ¡rios relacionados'],
};
function gerarChecklist(){
  const tipo = document.getElementById('checklistTipo').value;
  const area = document.getElementById('checklistArea');
  if(!tipo){ area.innerHTML=''; return; }
  const items = CHECKLISTS[tipo]||[];
  let html = `<div class="checklist" id="checklistItens">`;
  items.forEach((item,i) => {
    html += `<div class="check-item" id="ci${i}" onclick="toggleCheck(${i})">
      <div class="check-box" id="cb${i}"></div>
      <div class="check-label">${item}</div>
    </div>`;
  });
  html += `</div>
  <div class="check-progress"><div class="check-progress-fill" id="checkProgressFill" style="width:0%"></div></div>
  <div class="check-status" id="checkStatus">0 de ${items.length} documentos coletados</div>`;
  area.innerHTML = html;
}
function toggleCheck(i){
  const item = document.getElementById('ci'+i);
  const box = document.getElementById('cb'+i);
  item.classList.toggle('checked');
  box.textContent = item.classList.contains('checked') ? 'âœ“' : '';
  // Atualizar progresso
  const total = document.querySelectorAll('[id^="ci"]').length;
  const checked = document.querySelectorAll('[id^="ci"].checked').length;
  const pct = total>0 ? Math.round(checked/total*100) : 0;
  document.getElementById('checkProgressFill').style.width = pct+'%';
  document.getElementById('checkStatus').textContent = `${checked} de ${total} documentos coletados (${pct}%)`;
}

// â”€â”€ PROMPT BUILDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RULES = `REGRAS ABSOLUTAS:
1. PROBABILIDADE: Explique fator por fator o que pesou positivamente e negativamente.
2. JURISPRUDÃŠNCIA: Cite APENAS sÃºmulas que realmente existem. Se nÃ£o tiver certeza do nÃºmero, descreva o entendimento sem inventar. NUNCA invente nÃºmero de sÃºmula ou acÃ³rdÃ£o.
3. ARTIGOS DE LEI: Cite apenas artigos que existem na CLT, CC, CDC, CF/88 etc.
4. VALORES: Use parÃ¢metros reais. Se nÃ£o tiver base, escreva "varia conforme o juÃ­zo".
5. HONESTIDADE: Se nÃ£o souber, diga "dados insuficientes". Ã‰ melhor admitir limitaÃ§Ã£o do que inventar.`;

const STRUCTURE = `ESTRUTURA OBRIGATÃ“RIA:

## 1. RESUMO EXECUTIVO
[5 linhas mÃ¡ximo: o que Ã© o caso, qual a probabilidade, principal forÃ§a, principal risco, recomendaÃ§Ã£o imediata]

## 2. PROBABILIDADE DE ÃŠXITO
**Probabilidade Global: [X]%**
ClassificaÃ§Ã£o: [ALTA / MÃ‰DIA / BAIXA]
- âœ… Fator positivo 1: [argumento + peso]
- âœ… Fator positivo 2: [argumento + peso]
- âŒ Fator negativo 1: [fraqueza + impacto]
- âŒ Fator negativo 2: [fraqueza + impacto]
- âš ï¸ Fator incerto: [o que pode ir para qualquer lado]

## 3. IDENTIFICAÃ‡ÃƒO DO CASO
[Tipo de aÃ§Ã£o, partes, objeto, datas relevantes]

## 4. PONTOS FORTES
[MÃ­nimo 4 pontos. Argumento + lei ou princÃ­pio que sustenta]

## 5. PONTOS FRACOS E RISCOS
[MÃ­nimo 3 riscos. Problema + por que pode prejudicar]

## 6. JURISPRUDÃŠNCIA APLICÃVEL
[APENAS sÃºmulas reais. NÃºmero + tribunal + o que determina + aplicaÃ§Ã£o ao caso]

## 7. FUNDAMENTOS LEGAIS
[Artigos reais: nÃºmero + lei + o que determina + aplicaÃ§Ã£o]

## 8. ESTIMATIVA DE VALORES E HONORÃRIOS
[Faixas reais praticadas nos tribunais. HonorÃ¡rios estimados: X% a Y% sobre o proveito econÃ´mico]

## 9. ESBOÃ‡O DA PEÃ‡A PROCESSUAL
[QualificaÃ§Ã£o, fatos, direito, pedidos, valor da causa]

## 10. ESTRATÃ‰GIA E PRÃ“XIMOS PASSOS
[Acordo vs litÃ­gio, provas indispensÃ¡veis, prazos crÃ­ticos, riscos processuais]`;

const TONS = {
  imparcial:'AnÃ¡lise rigorosamente imparcial, pontos fortes e fracos de ambos os polos.',
  favoravel:'Foco nos melhores argumentos para o polo ativo.',
  defensivo:'Foco na defesa do polo passivo, fragilidades nos pedidos do autor.',
  estrategico:'AnÃ¡lise estratÃ©gica: acordo vs litÃ­gio, riscos, tÃ¡ticas e recomendaÃ§Ã£o objetiva.'
};

function buildPrompt(d){
  const ton = TONS[d.tom]||TONS.imparcial;
  const extra = d.extraContext ? `\nInstruÃ§Ãµes adicionais: ${d.extraContext}` : '';
  const cliente = d.cliente ? `\nCliente: ${d.cliente}` : '';
  const processo = d.processo ? `\nNÂº Processo: ${d.processo}` : '';

  const instrucao = `VocÃª Ã© um jurista brasileiro sÃªnior. Escreva uma anÃ¡lise jurÃ­dica completa e profissional.
Tom: ${ton}${cliente}${processo}
Data: ${d.data}${extra}`;

  if(currentMode==='upload'){
    const max=30000;
    const doc=extractedContent.length>max?extractedContent.substring(0,max)+'\n[Truncado]':extractedContent;
    return `${instrucao}\n\n${RULES}\n\nDOCUMENTO:\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n${doc}\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n${STRUCTURE}`;
  }
  return `${instrucao}\n\n${RULES}\n\nDADOS DO CASO:
Ãrea: ${d.area||'NÃ£o informado'}
Tipo: ${d.tipo||'NÃ£o informado'}
Autor: ${d.autor||'NÃ£o informado'}
RÃ©u: ${d.reu||'NÃ£o informado'}
Pedidos: ${d.pedidos||'NÃ£o informado'}
Tribunal: ${d.tribunal||'NÃ£o informado'}
Valor: ${d.valor?'R$ '+d.valor:'NÃ£o informado'}
Fatos: ${d.fatos||'NÃ£o informado'}

${STRUCTURE}`;
}

// â”€â”€ CHAMAR API GEMINI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function gemini(apiKey, messages, systemPrompt=''){
  const modelos = ['gemini-2.5-flash','gemini-2.0-flash','gemini-1.5-flash'];
  let ultimoErro = '';
  for(const modelo of modelos){
    try{
      const body = {
        contents: messages,
        generationConfig: {maxOutputTokens:16000, temperature:0.3}
      };
      if(systemPrompt) body.system_instruction = {parts:[{text:systemPrompt}]};
      const r = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/${modelo}:generateContent?key=${apiKey}`,
        {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}
      );
      if(!r.ok){
        const err=await r.json().catch(()=>({}));
        ultimoErro = `${modelo}: ${err.error?.message||'HTTP '+r.status}`;
        continue;
      }
      const data = await r.json();
      // Extrai texto de TODOS os candidates e parts
      let texto = '';
      for(const cand of (data.candidates||[])){
        for(const part of (cand?.content?.parts||[])){
          if(part.text) texto += part.text;
        }
      }
      if(texto.trim()) return texto.trim();
      ultimoErro = `${modelo}: resposta vazia (finishReason: ${data.candidates?.[0]?.finishReason||'?'})`;
    }catch(e){
      ultimoErro = `${modelo}: ${e.message}`;
    }
  }
  throw new Error('Falha em todos os modelos. Ãšltimo erro: '+ultimoErro+'\n\nVerifique sua chave em aistudio.google.com');
}

// â”€â”€ EXECUTAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function executar(){
  const apiKey = document.getElementById('apiKeyInput').value.trim();
  if(!apiKey||!apiKey.startsWith('AIza')){
    alert('ğŸ”‘ Cole sua chave de API!\n\nObtena grÃ¡tis em aistudio.google.com â†’ Get API Key');
    document.getElementById('apiKeyInput').focus(); return;
  }
  const d = {
    cliente:      document.getElementById('nomeCliente').value.trim(),
    processo:     document.getElementById('numProcesso').value.trim(),
    area:         document.getElementById('areaDir').value,
    tipo:         document.getElementById('tipoAcao').value.trim(),
    autor:        document.getElementById('autor').value.trim(),
    reu:          document.getElementById('reu').value.trim(),
    pedidos:      document.getElementById('pedidos').value.trim(),
    tribunal:     document.getElementById('tribunal').value,
    valor:        document.getElementById('valorCausa').value.trim(),
    tom:          document.querySelector('.tone-btn.active').dataset.tone,
    fatos:        document.getElementById('fatos').value.trim(),
    extraContext: document.getElementById('extraContext').value.trim(),
    data:         new Date().toLocaleDateString('pt-BR',{day:'2-digit',month:'2-digit',year:'numeric'})
  };
  if(currentMode==='upload'&&!extractedContent&&!extractedBase64){ alert('ğŸ“ FaÃ§a upload de um documento.'); return; }
  if(currentMode==='manual'){ if(!d.area){alert('Selecione a Ãrea do Direito.');return;} if(d.fatos.length<80){alert('Descreva os fatos com pelo menos 80 caracteres.');return;} }

  document.getElementById('inputCard').style.display='none';
  document.getElementById('loading').classList.add('visible');
  document.getElementById('resultCard').classList.remove('visible');

  const steps=['Lendo documento...','Analisando fundamentos jurÃ­dicos...','Verificando jurisprudÃªncia...','Calculando probabilidade...','Elaborando esboÃ§o processual...','Definindo estratÃ©gia...','Estimando honorÃ¡rios...','Compilando anÃ¡lise completa...'];
  let si=0; const iv=setInterval(()=>{ document.getElementById('loadingStep').textContent=steps[si++%steps.length]; },1800);

  try{
    // Extrai PDF/imagem primeiro se necessÃ¡rio
    if(currentMode==='upload'&&extractedBase64&&!extractedContent){
      document.getElementById('loadingStep').textContent='Extraindo texto do arquivo...';
      const mimeOk = extractedMime.startsWith('image/') ? extractedMime : 'application/pdf';
      try{
        const txt = await gemini(apiKey,
          [{role:'user',parts:[
            {inline_data:{mime_type:mimeOk,data:extractedBase64}},
            {text:'Transcreva TODO o texto deste documento jurÃ­dico na Ã­ntegra. NÃ£o resuma â€” transcreva completo.'}
          ]}]
        );
        if(txt){ extractedContent=txt; document.getElementById('extractedTxt').textContent=txt.substring(0,400)+'â€¦'; }
      }catch(e){ console.warn('ExtraÃ§Ã£o de arquivo falhou:',e.message); }
    }

    const prompt = buildPrompt(d);
    document.getElementById('loadingStep').textContent='Gerando anÃ¡lise completa...';
    const text = await gemini(apiKey, [{role:'user',parts:[{text:prompt}]}]);

    clearInterval(iv);
    analysisData = {formData:d, aiText:text, fileName:uploadedFile?.name||null};
    chatHistory = [{role:'user',parts:[{text:prompt}]},{role:'model',parts:[{text:text}]}];
    salvarHistorico(d, text);
    renderResult(d, text);
  }catch(e){
    clearInterval(iv);
    document.getElementById('loading').classList.remove('visible');
    document.getElementById('inputCard').style.display='block';
    alert('âš  Erro:\n\n'+e.message);
  }
}

// â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderResult(d, text){
  document.getElementById('loading').classList.remove('visible');
  document.getElementById('resultCard').classList.add('visible');

  // Probabilidade
  const m = text.match(/Probabilidade\s+Global[:\s*_]*(\d{1,3})\s*%/i)||text.match(/\*{0,2}(\d{1,3})\s*%\*{0,2}/);
  const prob = m ? Math.min(97,Math.max(5,parseInt(m[1]))) : null;
  if(prob!==null){
    const cls = prob>=70?'high':prob>=40?'medium':'low';
    document.getElementById('probValue').textContent=prob+'%';
    document.getElementById('probValue').className='prob-value '+cls;
    document.getElementById('probClass').textContent=prob>=70?'â¬† Alta Probabilidade':prob>=40?'â—ˆ Probabilidade Moderada':'â¬‡ Baixa Probabilidade';
    document.getElementById('probClass').style.color=prob>=70?'var(--green)':prob>=40?'var(--yellow)':'var(--red)';
    setTimeout(()=>{ const b=document.getElementById('probBar'); b.className='prob-bar-fill '+cls; b.style.width=prob+'%'; },300);
    const cap=v=>Math.min(97,Math.max(6,Math.round(v)));
    const rnd=(rng,off=0)=>off+Math.round((Math.random()-.5)*rng);
    const sc=[{n:'MÃ©rito JurÃ­dico',v:cap(prob+rnd(12,-3))},{n:'Base ProbatÃ³ria',v:cap(prob+rnd(10,-7))},{n:'JurisprudÃªncia',v:cap(prob+rnd(15,-5))},{n:'PosiÃ§Ã£o do Tribunal',v:cap(prob+rnd(18,-10))}];
    let h='<div style="margin-top:11px">';
    sc.forEach(s=>{ h+=`<div class="score-row"><div class="score-name">${s.n}</div><div class="score-mini-bar"><div class="score-mini-fill" data-val="${s.v}"></div></div><div class="score-pct">${s.v}%</div></div>`; });
    document.getElementById('scoreBreakdown').innerHTML=h+'</div>';
    setTimeout(()=>document.querySelectorAll('.score-mini-fill').forEach(el=>{ el.style.width=el.dataset.val+'%'; }),500);
  } else {
    document.getElementById('probValue').textContent='N/D';
    document.getElementById('probClass').textContent='Dados insuficientes';
  }

  // Resumo executivo
  const resumoMatch = text.match(/## 1\. RESUMO EXECUTIVO\n([\s\S]*?)(?=\n## 2\.)/i);
  const resumoTxt = resumoMatch ? resumoMatch[1].trim() : '';
  const itens = [
    {label:'Cliente', val: d.cliente||'â€”'},
    {label:'Processo', val: d.processo||'â€”'},
    {label:'Ãrea', val: d.area||currentMode==='upload'?'Documento':'â€”'},
    {label:'Probabilidade', val: prob!==null?prob+'%':'N/D'},
    {label:'Tom', val: d.tom||'imparcial'},
    {label:'Data', val: d.data}
  ];
  let resumoHtml = '';
  itens.forEach(it=>{ resumoHtml+=`<div class="resumo-item"><div class="resumo-item-label">${it.label}</div><div class="resumo-item-val">${it.val}</div></div>`; });
  if(resumoTxt){
    resumoHtml += `<div class="resumo-item" style="grid-column:1/-1"><div class="resumo-item-label">Resumo</div><div class="resumo-item-val" style="font-size:.78rem;font-weight:400;color:var(--muted)">${resumoTxt.replace(/\n/g,' ').substring(0,300)}</div></div>`;
  }
  document.getElementById('resumoItens').innerHTML = resumoHtml;

  document.getElementById('aiText').textContent = text;

  // Prompt para copiar
  document.getElementById('promptPreview').textContent = gerarPromptCopia(d, text);

  window.scrollTo({top:0,behavior:'smooth'});
}

// â”€â”€ CHAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function chatSugest(btn){
  document.getElementById('chatInput').value = btn.textContent;
  enviarChat();
}
function chatKeydown(e){
  if(e.key==='Enter'&&!e.shiftKey){ e.preventDefault(); enviarChat(); }
}
async function enviarChat(){
  const apiKey = document.getElementById('apiKeyInput').value.trim();
  if(!apiKey){ alert('Configure a chave de API primeiro.'); return; }
  if(!analysisData){ alert('Execute uma anÃ¡lise primeiro.'); return; }
  const input = document.getElementById('chatInput');
  const msg = input.value.trim();
  if(!msg) return;
  input.value='';
  document.getElementById('btnChatSend').disabled=true;

  const msgs = document.getElementById('chatMessages');

  // Mensagem do usuÃ¡rio
  const userDiv=document.createElement('div');
  userDiv.className='chat-msg user';
  userDiv.textContent=msg;
  msgs.appendChild(userDiv);

  // Loading
  const loadDiv=document.createElement('div');
  loadDiv.className='chat-msg ai loading-msg';
  loadDiv.textContent='Analisando...';
  msgs.appendChild(loadDiv);
  msgs.scrollTop=msgs.scrollHeight;

  // Adiciona Ã  histÃ³ria
  chatHistory.push({role:'user',parts:[{text:msg}]});

  try{
    const resp = await gemini(apiKey, chatHistory,
      `VocÃª Ã© um jurista brasileiro especialista. Responda APENAS sobre o caso jurÃ­dico jÃ¡ analisado. Seja direto e objetivo. NÃ£o invente jurisprudÃªncia.`
    );
    chatHistory.push({role:'model',parts:[{text:resp}]});
    loadDiv.className='chat-msg ai';
    loadDiv.textContent=resp;
  }catch(e){
    loadDiv.className='chat-msg ai';
    loadDiv.textContent='Erro: '+e.message;
  }
  msgs.scrollTop=msgs.scrollHeight;
  document.getElementById('btnChatSend').disabled=false;
}

// â”€â”€ HISTÃ“RICO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function salvarHistorico(d, text){
  try{
    const hist = JSON.parse(localStorage.getItem('v9_historico')||'[]');
    const prob = text.match(/Probabilidade\s+Global[:\s*_]*(\d{1,3})\s*%/i);
    hist.unshift({
      id: Date.now(),
      data: d.data,
      cliente: d.cliente||'â€”',
      tipo: d.tipo||d.area||'Documento',
      prob: prob?parseInt(prob[1]):null,
      texto: text,
      formData: d,
      fileName: analysisData?.fileName||null
    });
    // Manter apenas os 20 mais recentes
    localStorage.setItem('v9_historico', JSON.stringify(hist.slice(0,20)));
    atualizarContHist();
  }catch(e){ console.warn('Erro ao salvar histÃ³rico:', e); }
}
function atualizarContHist(){
  try{
    const hist = JSON.parse(localStorage.getItem('v9_historico')||'[]');
    document.getElementById('histCount').textContent = hist.length;
  }catch(e){}
}
function toggleHist(){
  const panel=document.getElementById('histPanel');
  const overlay=document.getElementById('overlay');
  const aberto=panel.classList.contains('open');
  panel.classList.toggle('open',!aberto);
  overlay.classList.toggle('open',!aberto);
  if(!aberto) renderHistorico();
}
function renderHistorico(){
  const list=document.getElementById('histList');
  try{
    const hist=JSON.parse(localStorage.getItem('v9_historico')||'[]');
    if(!hist.length){ list.innerHTML='<div class="hist-empty">Nenhuma anÃ¡lise salva ainda.</div>'; return; }
    list.innerHTML=hist.map(h=>{
      const cls=h.prob>=70?'high':h.prob>=40?'medium':'low';
      const probTxt=h.prob!==null?h.prob+'%':'N/D';
      return `<div class="hist-item" onclick="carregarHistorico(${h.id})">
        <div class="hist-item-titulo">${h.cliente!=='â€”'?h.cliente+' â€” ':''} ${h.tipo}</div>
        <div class="hist-item-meta">
          <span>${h.data}</span>
          <span class="hist-item-prob ${cls}">${probTxt}</span>
          ${h.fileName?`<span>ğŸ“ ${h.fileName.substring(0,20)}</span>`:''}
        </div>
      </div>`;
    }).join('');
  }catch(e){ list.innerHTML='<div class="hist-empty">Erro ao carregar histÃ³rico.</div>'; }
}
function carregarHistorico(id){
  try{
    const hist=JSON.parse(localStorage.getItem('v9_historico')||'[]');
    const item=hist.find(h=>h.id===id);
    if(!item) return;
    analysisData={formData:item.formData,aiText:item.texto,fileName:item.fileName};
    chatHistory=[{role:'user',parts:[{text:'AnÃ¡lise carregada do histÃ³rico.'}]},{role:'model',parts:[{text:item.texto}]}];
    document.getElementById('inputCard').style.display='none';
    document.getElementById('resultCard').classList.add('visible');
    renderResult(item.formData, item.texto);
    toggleHist();
  }catch(e){ alert('Erro ao carregar: '+e.message); }
}
function limparHistorico(){
  if(!confirm('Apagar todo o histÃ³rico?')) return;
  try{ localStorage.removeItem('v9_historico'); atualizarContHist(); renderHistorico(); }catch(e){}
}

// â”€â”€ PARSE SEÃ‡Ã•ES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function parseSec(text){
  if(!text) return [{title:'ANÃLISE COMPLETA',content:text}];
  const s=[];
  text.split(/(?=\n## \d+\.)/).forEach(p=>{
    const t=p.trim(); if(!t) return;
    const lines=t.split('\n');
    const title=lines[0].replace(/^#+\s*\d*\.?\s*/,'').replace(/\*\*/g,'').trim();
    const content=lines.slice(1).join('\n').trim();
    if(title&&content) s.push({title,content});
  });
  return s.length?s:[{title:'ANÃLISE COMPLETA',content:text}];
}

// â”€â”€ DOWNLOAD WORD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function dlWord(){
  if(!analysisData) return;
  const btn=document.getElementById('btnWord');
  btn.disabled=true; btn.textContent='â³ Gerando...';
  document.getElementById('dlStatus').textContent='Preparando Word...';
  try{
    const {Document,Packer,Paragraph,TextRun,AlignmentType,BorderStyle,Header,Footer,PageNumber}=docx;
    const d=analysisData.formData,text=analysisData.aiText,secs=parseSec(text);
    const p=(t,o={})=>new Paragraph({children:[new TextRun({text:String(t||''),font:'Arial',size:22,...o})],spacing:{after:120},alignment:AlignmentType.JUSTIFIED});
    const pc=(t,o={})=>new Paragraph({children:[new TextRun({text:String(t||''),font:'Arial',size:22,...o})],spacing:{after:100},alignment:AlignmentType.CENTER});
    const h1=(t)=>new Paragraph({children:[new TextRun({text:String(t||''),font:'Arial',size:26,bold:true,color:'8B6914'})],spacing:{before:320,after:120},border:{bottom:{style:BorderStyle.SINGLE,size:4,color:'C9A84C',space:4}}});
    const sp=()=>new Paragraph({children:[new TextRun({text:'',size:18})],spacing:{after:60}});
    const cover=[sp(),sp(),sp(),sp(),
      pc('V9 PRO',{size:56,bold:true,color:'C9A84C'}),
      pc('ANÃLISE JURÃDICA PROFISSIONAL',{size:28,bold:true,color:'8B6914'}),
      pc('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',{size:18,color:'C9A84C'}),sp()
    ];
    if(analysisData.fileName) cover.push(pc('Documento: '+analysisData.fileName,{size:20}));
    const flds=[['Cliente',d.cliente],['NÂº do Processo',d.processo],['Ãrea do Direito',d.area],['Tipo de AÃ§Ã£o',d.tipo],['Polo Ativo',d.autor],['Polo Passivo',d.reu],['Tribunal',d.tribunal],['Valor da Causa',d.valor?'R$ '+d.valor:''],['Data',d.data]].filter(([,v])=>v);
    flds.forEach(([k,v])=>cover.push(pc(`${k}: ${v}`,{size:20})));
    cover.push(sp(),pc('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',{size:18,color:'C9A84C'}),sp(),sp(),
      pc('Gerado por V9 Pro â€” Plataforma JurÃ­dica Profissional',{size:16,italics:true,color:'888888'}),
      pc('NÃƒO SUBSTITUI orientaÃ§Ã£o jurÃ­dica de advogado habilitado.',{size:16,italics:true,color:'888888'})
    );
    const body=[];
    if(flds.length){ body.push(h1('DADOS DO PROCESSO')); flds.forEach(([k,v])=>body.push(p(`${k}: ${v}`))); body.push(sp()); }
    secs.forEach(sec=>{
      body.push(h1(sec.title));
      sec.content.split('\n').forEach(line=>{
        const cl=line.replace(/\*\*/g,'').replace(/^#+\s*/,'').trim();
        if(!cl){body.push(sp());return;}
        const ind=/^[-â€¢âœ…âŒâš ï¸]\s/.test(line.trim());
        body.push(new Paragraph({children:[new TextRun({text:cl.replace(/^[-â€¢âœ…âŒâš ï¸]\s*/,''),font:'Arial',size:22})],spacing:{after:100},alignment:AlignmentType.JUSTIFIED,...(ind?{indent:{left:300}}:{})}));
      });
      body.push(sp());
    });
    body.push(pc('V9 Pro Â· '+d.data,{size:14,italics:true,color:'888888'}));
    const wdoc=new Document({
      sections:[
        {properties:{page:{size:{width:11906,height:16838},margin:{top:1440,right:1440,bottom:1440,left:1440}}},children:cover},
        {
          properties:{page:{size:{width:11906,height:16838},margin:{top:1440,right:1600,bottom:1440,left:1600}}},
          headers:{default:new Header({children:[new Paragraph({children:[new TextRun({text:'V9 PRO  Â·  ANÃLISE JURÃDICA PROFISSIONAL',font:'Arial',size:14,color:'C9A84C',bold:true})],alignment:AlignmentType.CENTER,border:{bottom:{style:BorderStyle.SINGLE,size:3,color:'C9A84C',space:4}}})]})},
          footers:{default:new Footer({children:[new Paragraph({children:[new TextRun({text:(d.area||d.tipo||'AnÃ¡lise')+'  Â·  PÃ¡g. ',font:'Arial',size:14,color:'888888'}),new TextRun({children:[PageNumber.CURRENT],font:'Arial',size:14,color:'888888'})],alignment:AlignmentType.CENTER})]})},
          children:body
        }
      ]
    });
    const buf=await Packer.toBuffer(wdoc);
    const blob=new Blob([buf],{type:'application/vnd.openxmlformats-officedocument.wordprocessingml.document'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url;
    a.download=`V9Pro_${(d.cliente||d.tipo||d.area||'Analise').replace(/\s+/g,'_').replace(/[^\w_]/g,'')}_${d.data.replace(/\//g,'-')}.docx`;
    document.body.appendChild(a); a.click();
    setTimeout(()=>{URL.revokeObjectURL(url);a.remove();},1000);
    document.getElementById('dlStatus').textContent='âœ“ Word gerado com sucesso!';
  }catch(e){ document.getElementById('dlStatus').textContent='âœ— Erro: '+e.message; }
  btn.disabled=false; btn.textContent='ğŸ“„ Baixar Word (.docx)';
}

// â”€â”€ DOWNLOAD PDF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function dlPDF(){
  if(!analysisData) return;
  const btn=document.getElementById('btnPdf');
  btn.disabled=true; btn.textContent='â³ Gerando...';
  document.getElementById('dlStatus').textContent='Preparando PDF...';
  try{
    const {jsPDF}=jspdf;
    const doc=new jsPDF({orientation:'portrait',unit:'mm',format:'a4'});
    const d=analysisData.formData,text=analysisData.aiText;
    const pw=210,ph=297,ml=18,mr=18,mb=18,cw=pw-ml-mr; let y=20;
    const G=[201,168,76],GD=[139,105,20],GR=[110,100,85],LT=[200,190,170],BG=[8,8,8];
    function np(){ doc.addPage(); doc.setFillColor(...BG); doc.rect(0,0,pw,ph,'F'); doc.setFillColor(20,18,12); doc.rect(0,0,pw,11,'F'); doc.setFont('helvetica','bold'); doc.setFontSize(6); doc.setTextColor(...G); doc.text('V9 PRO  Â·  ANÃLISE JURÃDICA PROFISSIONAL',pw/2,7,{align:'center'}); doc.setDrawColor(...GD); doc.setLineWidth(0.2); doc.line(ml,11,pw-mr,11); y=19; }
    function ck(n=8){ if(y+n>ph-mb-8) np(); }
    function sh(t){ ck(14); doc.setFillColor(22,20,12); doc.rect(ml-2,y-5,cw+4,9,'F'); doc.setDrawColor(...G); doc.setLineWidth(0.25); doc.line(ml-2,y+4,ml+cw+2,y+4); doc.setFont('helvetica','bold'); doc.setFontSize(8.5); doc.setTextColor(...G); doc.text(t.toUpperCase().substring(0,70),ml,y); y+=9; }
    function bd(t,ind=0){ if(!t||!t.trim()) return; doc.setFont('helvetica','normal'); doc.setFontSize(7.5); doc.setTextColor(...LT); doc.splitTextToSize(t.trim(),cw-ind).forEach(l=>{ ck(5); doc.text(l,ml+ind,y); y+=4.8; }); }
    doc.setFillColor(...BG); doc.rect(0,0,pw,ph,'F');
    doc.setDrawColor(...GD); doc.setLineWidth(0.25); doc.line(ml,14,pw-mr,14);
    doc.setDrawColor(...G); doc.setLineWidth(0.5); doc.line(ml,16,pw-mr,16);
    doc.setFont('helvetica','bold'); doc.setFontSize(26); doc.setTextColor(...G); doc.text('V9 PRO',pw/2,58,{align:'center'});
    doc.setFontSize(12); doc.setTextColor(...GD); doc.text('ANÃLISE JURÃDICA PROFISSIONAL',pw/2,67,{align:'center'});
    doc.setFontSize(7); doc.setTextColor(...GR); doc.text('ADVOGADOS  Â·  ESCRITÃ“RIOS  Â·  JURÃDICO INTERNO',pw/2,74,{align:'center'});
    doc.setDrawColor(...GD); doc.setLineWidth(0.25); doc.line(30,80,pw-30,80);
    let cy=92;
    if(analysisData.fileName){ doc.setFont('helvetica','bold'); doc.setFontSize(7.5); doc.setTextColor(...GD); doc.text('Documento:',ml+8,cy); doc.setFont('helvetica','normal'); doc.setTextColor(...LT); doc.text((analysisData.fileName||'').substring(0,50),ml+40,cy); cy+=7; }
    const flds=[['Cliente',d.cliente],['Processo',d.processo],['Ãrea',d.area],['Tipo',d.tipo],['Autor',d.autor],['RÃ©u',d.reu],['Tribunal',d.tribunal],['Valor',d.valor?'R$ '+d.valor:''],['Data',d.data]].filter(([,v])=>v);
    flds.forEach(([k,v])=>{ doc.setFont('helvetica','bold'); doc.setFontSize(7.5); doc.setTextColor(...GD); doc.text(k+':',ml+8,cy); doc.setFont('helvetica','normal'); doc.setTextColor(...LT); doc.text((v||'').substring(0,55),ml+34,cy); cy+=6.5; });
    doc.setDrawColor(...GD); doc.line(30,cy+3,pw-30,cy+3);
    doc.setFont('helvetica','italic'); doc.setFontSize(6.5); doc.setTextColor(...GR);
    doc.text('Gerado por V9 Pro  Â·  NÃƒO SUBSTITUI advogado habilitado.',pw/2,ph-14,{align:'center'});
    np(); sh('Dados do Processo');
    flds.forEach(([k,v])=>bd(`${k}: ${v}`)); y+=3;
    parseSec(text).forEach(sec=>{
      sh(sec.title);
      sec.content.split('\n').forEach(line=>{
        const cl=line.replace(/\*\*/g,'').replace(/^#+\s*/,'').trim();
        if(!cl){y+=1.2;return;}
        bd(/^[-â€¢âœ…âŒâš ï¸]\s/.test(line.trim())?'â€¢ '+cl.replace(/^[-â€¢âœ…âŒâš ï¸]\s*/,''):cl, /^[-â€¢âœ…âŒâš ï¸]\s/.test(line.trim())?4:0);
      }); y+=2.5;
    });
    const tot=doc.internal.getNumberOfPages();
    for(let i=2;i<=tot;i++){ doc.setPage(i); doc.setFont('helvetica','normal'); doc.setFontSize(6); doc.setTextColor(...GR); doc.text(`PÃ¡gina ${i} de ${tot}  Â·  V9 Pro  Â·  ${d.data}`,pw/2,ph-6,{align:'center'}); }
    doc.save(`V9Pro_${(d.cliente||d.tipo||d.area||'Analise').replace(/\s+/g,'_').replace(/[^\w_]/g,'')}_${d.data.replace(/\//g,'-')}.pdf`);
    document.getElementById('dlStatus').textContent='âœ“ PDF gerado com sucesso!';
  }catch(e){ document.getElementById('dlStatus').textContent='âœ— Erro: '+e.message; }
  btn.disabled=false; btn.textContent='ğŸ“• Baixar PDF';
}

// â”€â”€ PROMPT PARA COPIAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function gerarPromptCopia(d, text){
  const prob=text.match(/Probabilidade\s+Global[:\s*_]*(\d{1,3})\s*%/i);
  const probVal=prob?prob[1]+'%':'nÃ£o identificada';
  const secoes={};
  text.split(/(?=\n## \d+\.)/).forEach(p=>{
    const t=p.trim(); if(!t) return;
    const titulo=t.split('\n')[0].replace(/^#+\s*\d*\.?\s*/,'').trim().toLowerCase();
    if(titulo.includes('probabilidade')) secoes.prob=t;
    if(titulo.includes('jurisprud')) secoes.juris=t;
    if(titulo.includes('estratÃ©gia')||titulo.includes('prÃ³ximos')) secoes.estrategia=t;
    if(titulo.includes('pontos fort')) secoes.fortes=t;
    if(titulo.includes('pontos frac')||titulo.includes('riscos')) secoes.fracos=t;
    if(titulo.includes('fundamentos')) secoes.fund=t;
    if(titulo.includes('honorÃ¡rios')||titulo.includes('valores')) secoes.valores=t;
  });
  return `VocÃª Ã© um jurista brasileiro especialista. Aprofunde esta anÃ¡lise com rigor absoluto â€” NUNCA invente sÃºmulas ou dados.

CASO: ${d.cliente?'Cliente: '+d.cliente+' | ':''}${d.area||'Direito'} | ${d.tipo||'AnÃ¡lise JurÃ­dica'} | ${d.data}
PROBABILIDADE ESTIMADA: ${probVal}

${secoes.prob||''}
${secoes.juris||''}
${secoes.fortes||''}
${secoes.fracos||''}
${secoes.fund||''}
${secoes.valores||''}
${secoes.estrategia||''}

SOLICITO QUE VOCÃŠ:
1. Valide a probabilidade de ${probVal} â€” corrija se necessÃ¡rio
2. Confirme as sÃºmulas citadas e adicione as que faltam
3. Aprofunde a estratÃ©gia: acordo x litÃ­gio, provas indispensÃ¡veis
4. Elabore petiÃ§Ã£o inicial completa com fundamentos detalhados
5. Estime honorÃ¡rios advocatÃ­cios com base no valor da causa

IMPORTANTE: Se nÃ£o tiver certeza sobre jurisprudÃªncia, diga "nÃ£o localizado".`;
}
function copyPrompt(){
  const prompt=document.getElementById('promptPreview').textContent;
  if(!prompt) return;
  navigator.clipboard.writeText(prompt).then(()=>{
    const btn=document.getElementById('btnCopy');
    btn.classList.add('copied'); btn.textContent='âœ“ COPIADO!';
    document.getElementById('copyHint').textContent='âœ… Cole no ChatGPT, Claude ou qualquer IA';
    document.getElementById('copyHint').style.color='var(--green)';
    setTimeout(()=>{ btn.classList.remove('copied'); btn.innerHTML='ğŸ“‹ COPIAR PROMPT COMPLETO'; document.getElementById('copyHint').textContent='Cole no ChatGPT, Gemini, Claude ou qualquer IA para continuar'; document.getElementById('copyHint').style.color=''; },4000);
  }).catch(()=>{
    const ta=document.createElement('textarea'); ta.value=prompt; ta.style.cssText='position:fixed;opacity:0'; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
    document.getElementById('btnCopy').textContent='âœ“ COPIADO!';
    setTimeout(()=>{ document.getElementById('btnCopy').innerHTML='ğŸ“‹ COPIAR PROMPT COMPLETO'; },3000);
  });
}

// â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function reset(){
  document.getElementById('resultCard').classList.remove('visible');
  document.getElementById('inputCard').style.display='block';
  document.getElementById('dlStatus').textContent='';
  document.getElementById('chatMessages').innerHTML='';
  document.getElementById('prazoResultado').style.display='none';
  analysisData=null; chatHistory=[]; clearFile(null); setMode('upload');
  window.scrollTo({top:0,behavior:'smooth'});
}
</script>
</body>
</html>
